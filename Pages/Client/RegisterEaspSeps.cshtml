@page
@model RegisterEaspSepsModel
@{
    Layout = "~/Pages/Shared/_ClientLayout.cshtml";
    ViewData["Title"] = "ESAP/SEPS Registration";

}

<div class="container py-4">
    <h2 class="mb-4 text-center">@ViewData["Title"]</h2>

    @if (!string.IsNullOrEmpty(Model.SuccessMessage))
    {
        <div class="alert alert-success">@Model.SuccessMessage</div>
    }


    <form id="registrationForm" method="post" class="needs-validation" novalidate>
        <fieldset @(ViewData["IsReadOnly"] != null && (bool)ViewData["IsReadOnly"] ? "disabled" : "")>

            <div class="card mb-4 shadow-sm">
                <div class="card-header bg-primary text-white">
                    <h5 class="mb-0">Agency Information</h5>
                </div>
                <div class="card-body">
                    <div class="mb-3">
                        <label asp-for="EaspSepsRegistration.AgencyName" class="form-label font-weight-bold">Agency/Organization Name</label>
                        <input asp-for="EaspSepsRegistration.AgencyName" class="form-control" />
                        <span asp-validation-for="EaspSepsRegistration.AgencyName" class="text-danger"></span>
                    </div>

                    <div class="mb-3">
                        <label asp-for="EaspSepsRegistration.AlternateName" class="form-label font-weight-bold">Alternate Name</label>
                        <input asp-for="EaspSepsRegistration.AlternateName" class="form-control" placeholder="For multiple 'Alternate Names' separate with a comma" />
                        <span asp-validation-for="EaspSepsRegistration.AlternateName" class="text-danger"></span>
                    </div>

                    <div class="row">
                        <div class="col-md-6 mb-3">
                            <label asp-for="EaspSepsRegistration.County" class="form-label font-weight-bold">County</label>
                            <select asp-for="EaspSepsRegistration.County" asp-items="Model.CountyList" class="form-select"></select>
                            <span asp-validation-for="EaspSepsRegistration.County" class="text-danger"></span>
                        </div>
                    </div>

                    <div class="row">
                        <div class="col-md-6 mb-3">
                            <label asp-for="EaspSepsRegistration.Address" class="form-label font-weight-bold">Address</label>
                            <input asp-for="EaspSepsRegistration.Address" class="form-control" />
                            <span asp-validation-for="EaspSepsRegistration.Address" class="text-danger"></span>

                            <input asp-for="EaspSepsRegistration.Address2" class="form-control" />
                            <span asp-validation-for="EaspSepsRegistration.Address2" class="text-danger"></span>
                        </div>
                    </div>

                    <div class="row">
                        <div class="col-md-4 mb-3">
                            <label asp-for="EaspSepsRegistration.City" class="form-label font-weight-bold">City</label>
                            <input asp-for="EaspSepsRegistration.City" class="form-control" />
                            <span asp-validation-for="EaspSepsRegistration.City" class="text-danger"></span>
                        </div>
                        <div class="col-md-4 mb-3">
                            <label asp-for="EaspSepsRegistration.State" class="form-label font-weight-bold">State</label>
                            <input asp-for="EaspSepsRegistration.State" class="form-control" value="NY" readonly="readonly" />
                            <span asp-validation-for="EaspSepsRegistration.State" class="text-danger"></span>
                        </div>
                        <div class="col-md-4 mb-3">
                            <label asp-for="EaspSepsRegistration.Zip" class="form-label font-weight-bold">Zip</label>
                            <input asp-for="EaspSepsRegistration.Zip" class="form-control" />
                            <span asp-validation-for="EaspSepsRegistration.Zip" class="text-danger"></span>
                        </div>
                    </div>
                </div>
            </div>

            <div class="card mb-4 shadow-sm">
                <div class="card-header bg-primary text-white">
                    <h5 class="mb-0">Agency Contacts/Users</h5>
                </div>
                <div class="card-body">
                    <div class="row">
                        <div class="col-md-8 mb-3">
                            <label asp-for="AgencyContact.ProgramDirector" class="form-label font-weight-bold">Program Director</label>
                            <input asp-for="AgencyContact.ProgramDirector" class="form-control" />
                            <span asp-validation-for="AgencyContact.ProgramDirector" class="text-danger"></span>
                        </div>
                        <div class="col-md-4 mb-3">
                            <label asp-for="AgencyContact.SuffixId" class="form-label font-weight-bold">Suffix</label>
                            <select asp-for="AgencyContact.SuffixId" asp-items="Model.SuffixList" class="form-select"></select>
                        </div>
                    </div>

                    <div class="row">
                        <div class="col-md-6 mb-3">
                            <label asp-for="AgencyContact.Address" class="form-label font-weight-bold">Program Director Address</label>
                            <input asp-for="AgencyContact.Address" class="form-control" />
                            <span asp-validation-for="AgencyContact.Address" class="text-danger"></span>
                        </div>
                        <div class="col-md-6 mb-3 d-flex align-items-center">
                            <div class="form-check">
                                <input asp-for="AgencyContact.SameAddressAsAgency" type="checkbox" class="form-check-input" />
                                <label asp-for="AgencyContact.SameAddressAsAgency" class="form-check-label">Same Address As Agency</label>
                            </div>
                        </div>

                        <div class="col-md-6 mb-3">
                            <input asp-for="AgencyContact.Address2" class="form-control" />
                            <span asp-validation-for="AgencyContact.Address2" class="text-danger"></span>
                        </div>
                    </div>

                    <div class="row">
                        <div class="col-md-4 mb-3">
                            <label asp-for="AgencyContact.City" class="form-label font-weight-bold">City</label>
                            <input asp-for="AgencyContact.City" class="form-control" />
                            <span asp-validation-for="AgencyContact.City" class="text-danger"></span>
                        </div>
                        <div class="col-md-4 mb-3">
                            <label asp-for="AgencyContact.State" class="form-label font-weight-bold">State</label>
                            <input asp-for="AgencyContact.State" class="form-control" value="NY" readonly="readonly" />
                            <span asp-validation-for="AgencyContact.State" class="text-danger"></span>
                        </div>
                        <div class="col-md-4 mb-3">
                            <label asp-for="AgencyContact.Zip" class="form-label font-weight-bold">Zip</label>
                            <input asp-for="AgencyContact.Zip" class="form-control" />
                            <span asp-validation-for="AgencyContact.Zip" class="text-danger"></span>
                        </div>
                    </div>

                    <div class="row">
                        <div class="col-md-4 mb-3">
                            <label asp-for="AgencyContact.Phone" class="form-label font-weight-bold">Phone</label>
                            <input asp-for="AgencyContact.Phone" class="form-control phone-format" placeholder="(XXX)XXX-XXXX" />
                            <span asp-validation-for="AgencyContact.Phone" class="text-danger"></span>
                            <span asp-validation-for="AgencyContact.Phone" class="text-danger"></span>
                        </div>
                        <div class="col-md-4 mb-3">
                            <label asp-for="AgencyContact.PhoneExtension" class="form-label font-weight-bold">Extension</label>
                            <input asp-for="AgencyContact.PhoneExtension" class="form-control" />
                            <span asp-validation-for="AgencyContact.PhoneExtension" class="text-danger"></span>
                        </div>

                    </div>

                    <div class="row">
                        <div class="col-md-4 mb-3">
                            <label asp-for="AgencyContact.AltPhone" class="form-label font-weight-bold">Alt Phone</label>
                            <input asp-for="AgencyContact.Phone" class="form-control phone-format" placeholder="(XXX)XXX-XXXX" />
                            <span asp-validation-for="AgencyContact.AltPhone" class="text-danger"></span>
                        </div>
                        <div class="col-md-4 mb-3">
                            <label asp-for="AgencyContact.AltPhoneExtension" class="form-label font-weight-bold">Alt Phone Extension</label>
                            <input asp-for="AgencyContact.AltPhoneExtension" class="form-control" />
                            <span asp-validation-for="AgencyContact.AltPhoneExtension" class="text-danger"></span>
                        </div>
                    </div>

                    <div class="mb-3">
                        <label asp-for="AgencyContact.Email" class="form-label font-weight-bold">Email</label>
                        <input asp-for="AgencyContact.Email" class="form-control" readonly="readonly" />
                        <span asp-validation-for="AgencyContact.Email" class="text-danger"></span>
                    </div>
                </div>
            </div>

            <div class="card mb-4 shadow-sm">
                <div class="card-header bg-primary text-white">
                    <h5 class="mb-0">Additional Staff Contact (Optional)</h5>
                </div>
                <div class="card-body" id="additional-users-container">
                    @for (int i = 0; i < Model.AdditionalUsers.Count; i++)
                    {
                        <div class="additional-user mb-4 p-3 border rounded bg-light">
                            <div class="d-flex justify-content-between align-items-center mb-3">
                                <h5>Additional User @i</h5>
                                <button type="button" class="btn btn-danger btn-sm remove-additional-user" data-index="@i">&times;</button>
                            </div>
                            <div class="row mb-3">
                                <div class="col-md-2">
                                    <label asp-for="AdditionalUsers[i].PrefixId" class="form-label font-weight-bold">Prefix</label>
                                    <select asp-for="AdditionalUsers[i].PrefixId" asp-items="Model.PrefixList" class="form-select"></select>
                                </div>
                                <div class="col-md-8">
                                    <label asp-for="AdditionalUsers[i].Name" class="form-label font-weight-bold">Name</label>
                                    <input asp-for="AdditionalUsers[i].Name" class="form-control" />
                                    <span asp-validation-for="AdditionalUsers[i].Name" class="text-danger"></span>
                                </div>
                                <div class="col-md-2">
                                    <label asp-for="AdditionalUsers[i].SuffixId" class="form-label font-weight-bold">Suffix</label>
                                    <select asp-for="AdditionalUsers[i].SuffixId" asp-items="Model.SuffixList" class="form-select"></select>
                                </div>
                            </div>

                            <div class="row mb-3">
                                <div class="col-md-6">
                                    <label asp-for="AdditionalUsers[i].Title" class="form-label font-weight-bold">Additional Staff Title</label>
                                    <input asp-for="AdditionalUsers[i].Title" class="form-control" />
                                    <span asp-validation-for="AdditionalUsers[i].Title" class="text-danger"></span>
                                </div>
                            </div>

                            <div class="row mb-3">
                                <div class="col-md-6">
                                    <label asp-for="AdditionalUsers[i].Address" class="form-label font-weight-bold">Additional Staff Address</label>
                                    <input asp-for="AdditionalUsers[i].Address" class="form-control" />
                                    <span asp-validation-for="AdditionalUsers[i].Address" class="text-danger"></span>
                                </div>
                                <div class="col-md-6 d-flex align-items-center">
                                    <div class="form-check">
                                        <input asp-for="AdditionalUsers[i].SameAddressAsAgency" type="checkbox" class="form-check-input" />
                                        <label asp-for="AdditionalUsers[i].SameAddressAsAgency" class="form-check-label">Same Address As Agency</label>
                                    </div>
                                </div>
                            </div>

                            <div class="row mb-3">
                                <div class="col-md-6">
                                    <label asp-for="AdditionalUsers[i].Address2" class="form-label font-weight-bold">Address 2</label>
                                    <input asp-for="AdditionalUsers[i].Address2" class="form-control" />
                                    <span asp-validation-for="AdditionalUsers[i].Address2" class="text-danger"></span>
                                </div>
                            </div>

                            <div class="row mb-3">
                                <div class="col-md-4">
                                    <label asp-for="AdditionalUsers[i].City" class="form-label font-weight-bold">City</label>
                                    <input asp-for="AdditionalUsers[i].City" class="form-control" />
                                    <span asp-validation-for="AdditionalUsers[i].City" class="text-danger"></span>
                                </div>
                                <div class="col-md-4">
                                    <label asp-for="AdditionalUsers[i].State" class="form-label font-weight-bold">State</label>
                                    <input asp-for="AdditionalUsers[i].State" class="form-control" value="NY" readonly="readonly" />
                                    <span asp-validation-for="AdditionalUsers[i].State" class="text-danger"></span>
                                </div>
                                <div class="col-md-4">
                                    <label asp-for="AdditionalUsers[i].Zip" class="form-label font-weight-bold">Zip</label>
                                    <input asp-for="AdditionalUsers[i].Zip" class="form-control" />
                                    <span asp-validation-for="AdditionalUsers[i].Zip" class="text-danger"></span>
                                </div>
                            </div>

                            <div class="row mb-3">
                                <div class="col-md-4">
                                    <label asp-for="AdditionalUsers[i].Phone" class="form-label font-weight-bold">Phone</label>
                                    <input asp-for="AdditionalUsers[i].Phone" class="form-control phone-format" id="phoneInput" placeholder="(XXX)XXX-XXXX" />
                                    <span asp-validation-for="AdditionalUsers[i].Phone" class="text-danger"></span>
                                </div>
                            </div>

                            <div class="row mb-3">
                                <div class="col-md-6">
                                    <label asp-for="AdditionalUsers[i].Email" class="form-label font-weight-bold">Email</label>
                                    <input asp-for="AdditionalUsers[i].Email" class="form-control" type="email" />
                                    <span asp-validation-for="AdditionalUsers[i].Email" class="text-danger"></span>
                                </div>
                            </div>
                        </div>
                    }
                </div>
                <div class="d-flex justify-content-end">
                    <button type="button" id="add-additional-user" class="btn btn-outline-primary">Add Additional User</button>
                </div>
            </div>

            <div class="card mb-4 shadow-sm">
                <div class="card-header bg-primary text-white">
                    <h5 class="mb-0">Counties Served by the Agency</h5>
                </div>
                <div class="card-body">
                    @{
                        int itemsPerRow = 4;
                        int itemCount = Model.CountiesServed.Count;
                        int rows = (int)Math.Ceiling(itemCount / (double)itemsPerRow);
                    }

                    @for (int row = 0; row < rows; row++)
                    {
                        <div class="row mb-3">
                            @for (int col = 0; col < itemsPerRow; col++)
                            {
                                int index = row * itemsPerRow + col;
                                if (index >= itemCount)
                                {
                                    break;
                                }
                                <div class="col-md-3">
                                    <label class="form-label font-weight-bold">County @Html.Raw(index + 1)</label>
                                    <select asp-for="CountiesServed[index]" asp-items="Model.CountyList" class="form-select">
                                        <option value="0">Select County</option> <!-- Add this placeholder option -->
                                    </select>
                                </div>
                            }
                        </div>
                    }
                </div>
            </div>


            <div class="card mb-4 shadow-sm">
                <div class="card-header bg-primary text-white">
                    <h5 class="mb-0">Shipping Information</h5>
                </div>
                <div class="card-body">
                    <div class="row mb-3">
                        <div class="col-md-6">
                            <label asp-for="ShipInformation.ShipToName" class="form-label font-weight-bold">Ship To Name</label>
                            <input asp-for="ShipInformation.ShipToName" class="form-control" />
                            <span asp-validation-for="ShipInformation.ShipToName" class="text-danger"></span>
                        </div>
                        <div class="col-md-6">
                            <label asp-for="ShipInformation.ShipToEmail" class="form-label font-weight-bold">Ship To Email</label>
                            <input asp-for="ShipInformation.ShipToEmail" class="form-control" type="email" />
                            <span asp-validation-for="ShipInformation.ShipToEmail" class="text-danger"></span>
                        </div>
                    </div>

                    <div class="row mb-3">
                        <div class="col-md-6">
                            <label asp-for="ShipInformation.ShipToAddress" class="form-label font-weight-bold">Ship To Address</label>
                            <input asp-for="ShipInformation.ShipToAddress" class="form-control" />
                            <span asp-validation-for="ShipInformation.ShipToAddress" class="text-danger"></span>
                        </div>
                        <div class="col-md-6 d-flex align-items-center">
                            <div class="form-check">
                                <input asp-for="ShipInformation.SameAsSite" type="checkbox" class="form-check-input" />
                                <label asp-for="ShipInformation.SameAsSite" class="form-check-label">Same As Site</label>
                            </div>
                        </div>
                    </div>

                    <div class="row mb-3">
                        <div class="col-md-6">
                            <label asp-for="ShipInformation.ShipToAddress2" class="form-label font-weight-bold">Address 2</label>
                            <input asp-for="ShipInformation.ShipToAddress2" class="form-control" />
                            <span asp-validation-for="ShipInformation.ShipToAddress2" class="text-danger"></span>
                        </div>
                    </div>

                    <div class="row mb-3">
                        <div class="col-md-4">
                            <label asp-for="ShipInformation.ShipToCity" class="form-label font-weight-bold">City</label>
                            <input asp-for="ShipInformation.ShipToCity" class="form-control" />
                            <span asp-validation-for="ShipInformation.ShipToCity" class="text-danger"></span>
                        </div>
                        <div class="col-md-4">
                            <label asp-for="ShipInformation.ShipToState" class="form-label font-weight-bold">State</label>
                            <input asp-for="ShipInformation.ShipToState" class="form-control" value="NY" readonly="readonly" />
                            <span asp-validation-for="ShipInformation.ShipToState" class="text-danger"></span>
                        </div>
                        <div class="col-md-4">
                            <label asp-for="ShipInformation.ShipToZip" class="form-label font-weight-bold">Zip</label>
                            <input asp-for="ShipInformation.ShipToZip" class="form-control" />
                            <span asp-validation-for="ShipInformation.ShipToZip" class="text-danger"></span>
                        </div>
                    </div>
                </div>
            </div>

            <div id="additional-ship-to-sites-container" class="mb-4">
                @for (int i = 0; i < Model.AdditionalShipToSites.Count; i++)
                {
                    <div class="additional-ship-to-site mb-4 p-3 border rounded bg-light">
                        <div class="d-flex justify-content-between align-items-center mb-3">
                            <h5>Additional Ship to Site @i</h5>
                            <button type="button" class="btn btn-danger btn-sm remove-additional-ship-to-site" data-index="@i">&times;</button>
                        </div>
                        <div class="row mb-3">
                            <div class="col-md-6">
                                <label asp-for="AdditionalShipToSites[i].Name" class="form-label font-weight-bold">Name</label>
                                <input asp-for="AdditionalShipToSites[i].Name" class="form-control" />
                                <span asp-validation-for="AdditionalShipToSites[i].Name" class="text-danger"></span>
                            </div>
                        </div>
                        <div class="row mb-3">
                            <div class="col-md-6">
                                <label asp-for="AdditionalShipToSites[i].Address" class="form-label font-weight-bold">Address</label>
                                <input asp-for="AdditionalShipToSites[i].Address" class="form-control" />
                                <span asp-validation-for="AdditionalShipToSites[i].Address" class="text-danger"></span>
                            </div>
                        </div>
                        <div class="row mb-3">
                            <div class="col-md-6">
                                <label asp-for="AdditionalShipToSites[i].Address2" class="form-label font-weight-bold">Address 2</label>
                                <input asp-for="AdditionalShipToSites[i].Address2" class="form-control" />
                                <span asp-validation-for="AdditionalShipToSites[i].Address2" class="text-danger"></span>
                            </div>
                        </div>
                        <div class="row mb-3">
                            <div class="col-md-4">
                                <label asp-for="AdditionalShipToSites[i].City" class="form-label font-weight-bold">City</label>
                                <input asp-for="AdditionalShipToSites[i].City" class="form-control" />
                                <span asp-validation-for="AdditionalShipToSites[i].City" class="text-danger"></span>
                            </div>
                            <div class="col-md-4">
                                <label asp-for="AdditionalShipToSites[i].State" class="form-label font-weight-bold">State</label>
                                <input asp-for="AdditionalShipToSites[i].State" class="form-control" value="NY" readonly="readonly" />
                                <span asp-validation-for="AdditionalShipToSites[i].State" class="text-danger"></span>
                            </div>
                            <div class="col-md-4">
                                <label asp-for="AdditionalShipToSites[i].Zip" class="form-label font-weight-bold">Zip</label>
                                <input asp-for="AdditionalShipToSites[i].Zip" class="form-control" />
                                <span asp-validation-for="AdditionalShipToSites[i].Zip" class="text-danger"></span>
                            </div>
                        </div>
                        <div class="row mb-3">
                            <div class="col-md-4">
                                <label asp-for="AdditionalShipToSites[i].Phone" class="form-label font-weight-bold">Phone</label>
                                <input asp-for="AdditionalShipToSites[i].Phone" class="form-control phone-format" placeholder="(XXX)XXX-XXXX" />
                                <span asp-validation-for="AdditionalShipToSites[i].Phone" class="text-danger"></span>
                            </div>
                            <div class="col-md-4">
                                <label asp-for="AdditionalShipToSites[i].PhoneExtension" class="form-label font-weight-bold">Extension</label>
                                <input asp-for="AdditionalShipToSites[i].PhoneExtension" class="form-control" />
                                <span asp-validation-for="AdditionalShipToSites[i].PhoneExtension" class="text-danger"></span>
                            </div>
                        </div>
                        <div class="row mb-3">
                            <div class="col-md-4">
                                <label asp-for="AdditionalShipToSites[i].SiteType" class="form-label font-weight-bold">Site Type</label>
                                <div class="form-check">
                                    <input type="radio" asp-for="AdditionalShipToSites[i].SiteType" value="Business" class="form-check-input" />
                                    <label class="form-check-label" for="AdditionalShipToSites[i].SiteType_Business">Business</label>
                                </div>
                                <div class="form-check">
                                    <input type="radio" asp-for="AdditionalShipToSites[i].SiteType" value="Personal" class="form-check-input" />
                                    <label class="form-check-label" for="AdditionalShipToSites[i].SiteType_Personal">Personal</label>
                                </div>
                                <span asp-validation-for="AdditionalShipToSites[i].SiteType" class="text-danger"></span>
                            </div>
                        </div>
                        <div class="row mb-3">
                            <div class="col-md-6">
                                <label asp-for="AdditionalShipToSites[i].ShipToName" class="form-label font-weight-bold">Ship To Name</label>
                                <input asp-for="AdditionalShipToSites[i].ShipToName" class="form-control" />
                                <span asp-validation-for="AdditionalShipToSites[i].ShipToName" class="text-danger"></span>
                            </div>
                            <div class="col-md-6">
                                <label asp-for="AdditionalShipToSites[i].ShipToEmail" class="form-label font-weight-bold">Ship To Email</label>
                                <input asp-for="AdditionalShipToSites[i].ShipToEmail" class="form-control" type="email" />
                                <span asp-validation-for="AdditionalShipToSites[i].ShipToEmail" class="text-danger"></span>
                            </div>
                        </div>
                        <div class="row mb-3">
                            <div class="col-md-6">
                                <label asp-for="AdditionalShipToSites[i].ShipToAddress" class="form-label font-weight-bold">Ship To Address</label>
                                <input asp-for="AdditionalShipToSites[i].ShipToAddress" class="form-control" />
                                <span asp-validation-for="AdditionalShipToSites[i].ShipToAddress" class="text-danger"></span>
                            </div>
                            <div class="col-md-3 d-flex align-items-center">
                                <input type="checkbox" asp-for="AdditionalShipToSites[i].SameAsSite" class="form-check-input" />
                                <label class="form-check-label ml-2" asp-for="AdditionalShipToSites[i].SameAsSite">Same As Site</label>
                            </div>
                        </div>
                        <div class="row mb-3">
                            <div class="col-md-6">
                                <label asp-for="AdditionalShipToSites[i].ShipToAddress2" class="form-label font-weight-bold">Ship To Address 2</label>
                                <input asp-for="AdditionalShipToSites[i].ShipToAddress2" class="form-control" />
                                <span asp-validation-for="AdditionalShipToSites[i].ShipToAddress2" class="text-danger"></span>
                            </div>
                        </div>
                        <div class="row mb-3">
                            <div class="col-md-4">
                                <label asp-for="AdditionalShipToSites[i].ShipToCity" class="form-label font-weight-bold">Ship To City</label>
                                <input asp-for="AdditionalShipToSites[i].ShipToCity" class="form-control" />
                                <span asp-validation-for="AdditionalShipToSites[i].ShipToCity" class="text-danger"></span>
                            </div>
                            <div class="col-md-4">
                                <label asp-for="AdditionalShipToSites[i].ShipToState" class="form-label font-weight-bold">Ship To State</label>
                                <input asp-for="AdditionalShipToSites[i].ShipToState" class="form-control" value="NY" readonly="readonly" />
                                <span asp-validation-for="AdditionalShipToSites[i].ShipToState" class="text-danger"></span>
                            </div>
                            <div class="col-md-4">
                                <label asp-for="AdditionalShipToSites[i].ShipToZip" class="form-label font-weight-bold">Ship To Zip</label>
                                <input asp-for="AdditionalShipToSites[i].ShipToZip" class="form-control" />
                                <span asp-validation-for="AdditionalShipToSites[i].ShipToZip" class="text-danger"></span>
                            </div>
                        </div>

                        <h5 class="mt-4">Primary Counties Served by Site:</h5>
                        <div class="row mb-3">
                            <div class="row mb-3">
                                @if (Model.ShipToSiteCounties[i] != null)
                                {
                                    for (int j = 0; j < Model.ShipToSiteCounties[i].Length; j++)
                                    {
                                        <div class="col-md-2">
                                            <select asp-for="ShipToSiteCounties[i][j]" asp-items="Model.CountyList" class="form-select"></select>
                                        </div>
                                    }
                                }
                            </div>

                        </div>
                    </div>
                }
            </div>


            <div class="d-flex justify-content-end">
                <button type="button" id="add-additional-ship-to-site" class="btn btn-outline-primary">Add Additional Ship to Site</button>
            </div>

            <div class="d-flex justify-content-center mt-5">
                <button type="submit" class="btn btn-success btn-lg px-5">Submit</button>
            </div>
        </fieldset>

    </form>
</div>

@section Scripts {
    <partial name="_ValidationScriptsPartial" />
    <script>
        document.addEventListener("DOMContentLoaded", function () {
            // Convert the Razor boolean into lowercase 'true' or 'false' for JavaScript
            const isReadOnly = @((bool)ViewData["IsReadOnly"] ? "true" : "false");

            if (isReadOnly === "true") {
                // Disable all form fields and the submit button
                const formElements = document.querySelectorAll('#registrationForm input, #registrationForm select, #registrationForm textarea, #registrationForm button[type="submit"]');
                formElements.forEach(function (element) {
                    element.disabled = true; // Disable the form elements
                });
            }
        });
        const countyList = @Html.Raw(Newtonsoft.Json.JsonConvert.SerializeObject(Model.CountyList));

        document.getElementById("add-additional-ship-to-site").addEventListener("click", function () {
            const container = document.getElementById("additional-ship-to-sites-container");
            const index = container.children.length;

            if (index < 2) {
                const newShipToSite = document.createElement("div");
                newShipToSite.classList.add("additional-ship-to-site", "mb-4", "p-3", "border", "rounded", "bg-light");
                newShipToSite.innerHTML = `
                    <div class="d-flex justify-content-between align-items-center mb-3">
                        <h5>Additional Ship to Site ${index + 1}</h5>
                        <button type="button" class="btn btn-danger btn-sm remove-additional-ship-to-site" data-index="${index}">&times;</button>
                    </div>
                    <div class="row mb-3">
                        <div class="col-md-6">
                            <label for="AdditionalShipToSites_${index}__Name" class="form-label font-weight-bold">Name</label>
                            <input type="text" id="AdditionalShipToSites_${index}__Name" name="AdditionalShipToSites[${index}].Name" class="form-control" />
                        </div>
                    </div>
                    <div class="row mb-3">
                        <div class="col-md-6">
                            <label for="AdditionalShipToSites_${index}__Address" class="form-label font-weight-bold">Address</label>
                            <input type="text" id="AdditionalShipToSites_${index}__Address" name="AdditionalShipToSites[${index}].Address" class="form-control" />
                        </div>
                    </div>
                    <div class="row mb-3">
                        <div class="col-md-6">
                            <label for="AdditionalShipToSites_${index}__Address2" class="form-label font-weight-bold">Address 2</label>
                            <input type="text" id="AdditionalShipToSites_${index}__Address2" name="AdditionalShipToSites[${index}].Address2" class="form-control" />
                        </div>
                    </div>
                    <div class="row mb-3">
                        <div class="col-md-4">
                            <label for="AdditionalShipToSites_${index}__City" class="form-label font-weight-bold">City</label>
                            <input type="text" id="AdditionalShipToSites_${index}__City" name="AdditionalShipToSites[${index}].City" class="form-control" />
                        </div>
                        <div class="col-md-4">
                            <label for="AdditionalShipToSites_${index}__State" class="form-label font-weight-bold">State</label>
                            <input type="text" id="AdditionalShipToSites_${index}__State" name="AdditionalShipToSites[${index}].State" class="form-control" value="NY" readonly="readonly" />
                        </div>
                        <div class="col-md-4">
                            <label for="AdditionalShipToSites_${index}__Zip" class="form-label font-weight-bold">Zip</label>
                            <input type="text" id="AdditionalShipToSites_${index}__Zip" name="AdditionalShipToSites[${index}].Zip" class="form-control" />
                        </div>
                    </div>
                    <div class="row mb-3">
                        <div class="col-md-4">
                            <label for="AdditionalShipToSites_${index}__Phone" class="form-label font-weight-bold">Phone</label>
                            <input type="text" id="AdditionalShipToSites_${index}__Phone" name="AdditionalShipToSites[${index}].Phone" class="form-control phone-format" id="phoneInput" placeholder="(XXX)XXX-XXXX" />
                        </div>
                        <div class="col-md-4">
                            <label for="AdditionalShipToSites_${index}__PhoneExtension" class="form-label font-weight-bold">Extension</label>
                            <input type="text" id="AdditionalShipToSites_${index}__PhoneExtension" name="AdditionalShipToSites[${index}].PhoneExtension" class="form-control" />
                        </div>
                        <div class="col-md-4">
                            <label for="AdditionalShipToSites_${index}__SiteType" class="form-label font-weight-bold">Site Type</label>
                            <div class="form-check">
                                <input type="radio" id="AdditionalShipToSites_${index}__SiteType_Business" name="AdditionalShipToSites[${index}].SiteType" value="Business" class="form-check-input" />
                                <label class="form-check-label" for="AdditionalShipToSites_${index}__SiteType_Business">Business</label>
                            </div>
                            <div class="form-check">
                                <input type="radio" id="AdditionalShipToSites_${index}__SiteType_Personal" name="AdditionalShipToSites[${index}].SiteType" value="Personal" class="form-check-input" />
                                <label class="form-check-label" for="AdditionalShipToSites_${index}__SiteType_Personal">Personal</label>
                            </div>
                        </div>
                    </div>

                    <div class="row mb-3">
                        <div class="col-md-6">
                            <label for="AdditionalShipToSites_${index}__ShipToName" class="form-label font-weight-bold">Ship To Name</label>
                            <input type="text" id="AdditionalShipToSites_${index}__ShipToName" name="AdditionalShipToSites[${index}].ShipToName" class="form-control" />
                        </div>
                        <div class="col-md-6">
                            <label for="AdditionalShipToSites_${index}__ShipToEmail" class="form-label font-weight-bold">Ship To Email</label>
                            <input type="email" id="AdditionalShipToSites_${index}__ShipToEmail" name="AdditionalShipToSites[${index}].ShipToEmail" class="form-control" />
                        </div>
                    </div>

                    <div class="row mb-3">
                        <div class="col-md-6">
                            <label for="AdditionalShipToSites_${index}__ShipToAddress" class="form-label font-weight-bold">Ship To Address</label>
                            <input type="text" id="AdditionalShipToSites_${index}__ShipToAddress" name="AdditionalShipToSites[${index}].ShipToAddress" class="form-control" />
                        </div>
                        <div class="col-md-3 d-flex align-items-center">
                            <input type="checkbox" id="AdditionalShipToSites_${index}__SameAsSite" name="AdditionalShipToSites[${index}].SameAsSite" class="form-check-input" />
                            <label class="form-check-label ml-2" for="AdditionalShipToSites_${index}__SameAsSite">Same As Site</label>
                        </div>
                    </div>

                    <div class="row mb-3">
                        <div class="col-md-6">
                            <label for="AdditionalShipToSites_${index}__ShipToAddress2" class="form-label font-weight-bold">Ship To Address 2</label>
                            <input type="text" id="AdditionalShipToSites_${index}__ShipToAddress2" name="AdditionalShipToSites[${index}].ShipToAddress2" class="form-control" />
                        </div>
                    </div>

                    <div class="row mb-3">
                        <div class="col-md-4">
                            <label for="AdditionalShipToSites_${index}__ShipToCity" class="form-label font-weight-bold">Ship To City</label>
                            <input type="text" id="AdditionalShipToSites_${index}__ShipToCity" name="AdditionalShipToSites[${index}].ShipToCity" class="form-control" />
                        </div>
                        <div class="col-md-4">
                            <label for="AdditionalShipToSites_${index}__ShipToState" class="form-label font-weight-bold">Ship To State</label>
                            <input type="text" id="AdditionalShipToSites_${index}__ShipToState" name="AdditionalShipToSites[${index}].ShipToState" class="form-control" value="NY" readonly="readonly" />
                        </div>
                        <div class="col-md-4">
                            <label for="AdditionalShipToSites_${index}__ShipToZip" class="form-label font-weight-bold">Ship To Zip</label>
                            <input type="text" id="AdditionalShipToSites_${index}__ShipToZip" name="AdditionalShipToSites[${index}].ShipToZip" class="form-control" />
                             </div>
                    </div>

                    <div class="row mb-3">
                <div class="col-md-12">
                    <label class="form-label font-weight-bold">Primary Counties Served by Site</label>
                    <div class="row">
                        ${Array.from({ length: 5 }).map((_, j) => `
                            <div class="col-md-2 mb-2">
                                <select id="ShipToSiteCounties_${index}__${j}" name="ShipToSiteCounties[${index}][${j}]" class="form-select">
                                    <option value="0" selected>Select County</option>
                                    ${countyList.map(county => `
                                        <option value="${county.Value}">${county.Text}</option>
                                    `).join('')}
                                </select>
                            </div>
                        `).join('')}
                    </div>
                </div>
            </div>


                `;
                container.appendChild(newShipToSite);
            } else {
                alert("You can only add up to 2 additional ship to sites.");
            }
        });

        // Script for adding additional users
        let additionalUserIndex = @Model.AdditionalUsers.Count;

        document.getElementById("add-additional-user").addEventListener("click", function () {
            if (additionalUserIndex >= 5) {
                alert("You can only add up to 5 additional users.");
                return;
            }

            const container = document.getElementById("additional-users-container");
            const newUser = document.createElement("div");
            newUser.classList.add("additional-user", "mb-4", "p-3", "border", "rounded", "bg-light");
            newUser.innerHTML = `
                <div class="d-flex justify-content-between align-items-center mb-3">
                    <h5>Additional User ${additionalUserIndex + 1}</h5>
                    <button type="button" class="btn btn-danger btn-sm remove-additional-user" data-index="${additionalUserIndex}">&times;</button>
                </div>
                <div class="row mb-3">
                    <div class="col-md-2">
                        <label for="AdditionalUsers_${additionalUserIndex}__PrefixId" class="form-label font-weight-bold">Prefix</label>
                        <select id="AdditionalUsers_${additionalUserIndex}__PrefixId" name="AdditionalUsers[${additionalUserIndex}].PrefixId" class="form-select">
                            @foreach(var prefix in Model.PrefixList)
                            {
                                <option value="@prefix.Value">@prefix.Text</option>
                            }
                        </select>
                    </div>
                    <div class="col-md-8">
                        <label for="AdditionalUsers_${additionalUserIndex}__Name" class="form-label font-weight-bold">Name</label>
                        <input type="text" id="AdditionalUsers_${additionalUserIndex}__Name" name="AdditionalUsers[${additionalUserIndex}].Name" class="form-control" />
                        <span class="text-danger" asp-validation-for="AdditionalUsers[${additionalUserIndex}].Name"></span>
                    </div>
                    <div class="col-md-2">
                        <label for="AdditionalUsers_${additionalUserIndex}__SuffixId" class="form-label font-weight-bold">Suffix</label>
                        <select id="AdditionalUsers_${additionalUserIndex}__SuffixId" name="AdditionalUsers[${additionalUserIndex}].SuffixId" class="form-select">
                            @foreach(var suffix in Model.SuffixList)
                            {
                                <option value="@suffix.Value">@suffix.Text</option>
                            }
                        </select>
                    </div>
                </div>
                <div class="row mb-3">
                    <div class="col-md-6">
                        <label for="AdditionalUsers_${additionalUserIndex}__Title" class="form-label font-weight-bold">Additional Staff Title</label>
                        <input type="text" id="AdditionalUsers_${additionalUserIndex}__Title" name="AdditionalUsers[${additionalUserIndex}].Title" class="form-control" />
                        <span class="text-danger" asp-validation-for="AdditionalUsers[${additionalUserIndex}].Title"></span>
                    </div>
                </div>
                <div class="row mb-3">
                    <div class="col-md-6">
                        <label for="AdditionalUsers_${additionalUserIndex}__Address" class="form-label font-weight-bold">Additional Staff Address</label>
                        <input type="text" id="AdditionalUsers_${additionalUserIndex}__Address" name="AdditionalUsers[${additionalUserIndex}].Address" class="form-control" />
                        <span class="text-danger" asp-validation-for="AdditionalUsers[${additionalUserIndex}].Address"></span>
                    </div>
                    <div class="col-md-6 d-flex align-items-center">
                        <div class="form-check">
                            <input type="checkbox" id="AdditionalUsers_${additionalUserIndex}__SameAddressAsAgency" name="AdditionalUsers[${additionalUserIndex}].SameAddressAsAgency" class="form-check-input" />
                            <label class="form-check-label" for="AdditionalUsers_${additionalUserIndex}__SameAddressAsAgency">Same Address As Agency</label>
                        </div>
                    </div>
                </div>
                <div class="row mb-3">
                    <div class="col-md-6">
                        <label for="AdditionalUsers_${additionalUserIndex}__Address2" class="form-label font-weight-bold">Address 2</label>
                        <input type="text" id="AdditionalUsers_${additionalUserIndex}__Address2" name="AdditionalUsers[${additionalUserIndex}].Address2" class="form-control" />
                        <span class="text-danger" asp-validation-for="AdditionalUsers[${additionalUserIndex}].Address2"></span>
                    </div>
                </div>
                <div class="row mb-3">
                    <div class="col-md-4">
                        <label for="AdditionalUsers_${additionalUserIndex}__City" class="form-label font-weight-bold">City</label>
                        <input type="text" id="AdditionalUsers_${additionalUserIndex}__City" name="AdditionalUsers[${additionalUserIndex}].City" class="form-control" />
                        <span class="text-danger" asp-validation-for="AdditionalUsers[${additionalUserIndex}].City"></span>
                    </div>
                    <div class="col-md-4">
                        <label for="AdditionalUsers_${additionalUserIndex}__State" class="form-label font-weight-bold">State</label>
                        <input type="text" id="AdditionalUsers_${additionalUserIndex}__State" name="AdditionalUsers[${additionalUserIndex}].State" class="form-control" value="NY" readonly="readonly" />
                        <span class="text-danger" asp-validation-for="AdditionalUsers[${additionalUserIndex}].State"></span>
                    </div>
                    <div class="col-md-4">
                        <label for="AdditionalUsers_${additionalUserIndex}__Zip" class="form-label font-weight-bold">Zip</label>
                        <input type="text" id="AdditionalUsers_${additionalUserIndex}__Zip" name="AdditionalUsers[${additionalUserIndex}].Zip" class="form-control" />
                        <span class="text-danger" asp-validation-for="AdditionalUsers[${additionalUserIndex}].Zip"></span>
                    </div>
                </div>
                <div class="row mb-3">
                    <div class="col-md-4">
                        <label for="AdditionalUsers_${additionalUserIndex}__Phone" class="form-label font-weight-bold">Phone</label>
                        <input type="text" id="AdditionalUsers_${additionalUserIndex}__Phone" name="AdditionalUsers[${additionalUserIndex}].Phone" class="form-control" />
                        <span class="text-danger" asp-validation-for="AdditionalUsers[${additionalUserIndex}].Phone"></span>
                    </div>
                </div>
                <div class="row mb-3">
                    <div class="col-md-6">
                        <label for="AdditionalUsers_${additionalUserIndex}__Email" class="form-label font-weight-bold">Email</label>
                        <input type="email" id="AdditionalUsers_${additionalUserIndex}__Email" name="AdditionalUsers[${additionalUserIndex}].Email" class="form-control" />
                        <span class="text-danger" asp-validation-for="AdditionalUsers[${additionalUserIndex}].Email"></span>
                    </div>
                </div>
            `;
            container.appendChild(newUser);
            additionalUserIndex++;
        });

        document.addEventListener("click", function (event) {
            if (event.target.classList.contains("remove-additional-user")) {
                const index = event.target.getAttribute("data-index");
                const userElement = document.getElementById(`AdditionalUsers_${index}__Name`).closest(".additional-user");
                userElement.remove();
                additionalUserIndex--;
            }

            if (event.target.classList.contains("remove-additional-ship-to-site")) {
                const index = event.target.getAttribute("data-index");
                const shipToSiteElement = document.getElementById(`AdditionalShipToSites_${index}__Name`).closest(".additional-ship-to-site");
                shipToSiteElement.remove();
            }
        });

        // Auto-fill Ship To Address if Same As Site is checked
        document.querySelector('input[name="ShipInformation.SameAsSite"]').addEventListener("change", function () {
            if (this.checked) {
                document.querySelector('input[name="ShipInformation.ShipToAddress"]').value = document.querySelector('[name="EaspSepsRegistration.Address"]').value;
                document.querySelector('input[name="ShipInformation.ShipToAddress2"]').value = document.querySelector('[name="EaspSepsRegistration.Address2"]').value;
                document.querySelector('input[name="ShipInformation.ShipToCity"]').value = document.querySelector('[name="EaspSepsRegistration.City"]').value;
                document.querySelector('input[name="ShipInformation.ShipToState"]').value = document.querySelector('[name="EaspSepsRegistration.State"]').value;
                document.querySelector('input[name="ShipInformation.ShipToZip"]').value = document.querySelector('[name="EaspSepsRegistration.Zip"]').value;
            }
        });

        // Auto-fill Program Director Address if Same Address As Agency is checked
        document.querySelector('input[name="AgencyContact.SameAddressAsAgency"]').addEventListener("change", function () {
            if (this.checked) {
                document.querySelector('input[name="AgencyContact.Address"]').value = document.querySelector('[name="EaspSepsRegistration.Address"]').value;
                document.querySelector('input[name="AgencyContact.Address2"]').value = document.querySelector('[name="EaspSepsRegistration.Address2"]').value;
                document.querySelector('input[name="AgencyContact.City"]').value = document.querySelector('[name="EaspSepsRegistration.City"]').value;
                document.querySelector('input[name="AgencyContact.State"]').value = document.querySelector('[name="EaspSepsRegistration.State"]').value;
                document.querySelector('input[name="AgencyContact.Zip"]').value = document.querySelector('[name="EaspSepsRegistration.Zip"]').value;
                document.querySelector('input[name="AgencyContact.Phone"]').value = document.querySelector('[name="EaspSepsRegistration.Phone"]').value;
                document.querySelector('input[name="AgencyContact.PhoneExtension"]').value = document.querySelector('[name="EaspSepsRegistration.PhoneExtension"]').value;
                document.querySelector('input[name="AgencyContact.AltPhone"]').value = document.querySelector('[name="EaspSepsRegistration.AltPhone"]').value;
                document.querySelector('input[name="AgencyContact.AltPhoneExtension"]').value = document.querySelector('[name="EaspSepsRegistration.AltPhoneExtension"]').value;
                document.querySelector('input[name="AgencyContact.Email"]').value = document.querySelector('[name="EaspSepsRegistration.Email"]').value;
            }
        });

        document.addEventListener("DOMContentLoaded", function () {
            // Function to format the phone number
            function formatPhoneNumber(input) {
                var cleaned = input.replace(/\D/g, ''); // Remove all non-digit characters
                var formattedInput = '';

                if (cleaned.length > 0) {
                    formattedInput += '(' + cleaned.substring(0, 3);
                }
                if (cleaned.length >= 4) {
                    formattedInput += ')' + cleaned.substring(3, 6);
                }
                if (cleaned.length >= 7) {
                    formattedInput += '-' + cleaned.substring(6, 10);
                }

                return formattedInput;
            }
            // Event delegation to handle dynamically added inputs
            document.addEventListener('input', function (e) {
                if (e.target.classList.contains('phone-format')) {
                    e.target.value = formatPhoneNumber(e.target.value);
                }
            });
        });
    </script>
}